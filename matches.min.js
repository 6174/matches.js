// matches.js
// ----------
// Powerful pattern matching for Javascript
//
// version : 0.3.1
// author  : Nathan Faubion <nathan@n-son.com>
// license : MIT
(function(){function e(t){return e.modules[t]}e.modules={},e.modules["./parser"]=function(){function n(e){var t=new r(e),n=i(t);return n}function r(e){this.input=e,this.buffer=e,this.pos=0}function i(e){var t=s(e.skipWs());return e.skipWs().buffer&&Ct(e),t}function s(e){return st(o(e))}function o(e){return C(f,e)}function u(e){return C(a,e,k())}function a(e){return l(e)||f(e)}function f(e){return c(e)||h(e)||p(e)||d(e)||v(e)||m(e)||g(e)||y(e)||b(e)||x(e)}function l(e){var t=e.takeAPeek(z);if(t)return ut(t[1]);var n=e.takeAPeek("...");if(n)return ot(n)}function c(e){if(e.takeAPeek("_"))return at()}function h(e){if(e.takeAPeek(q))return ft()}function p(e){if(e.takeAPeek(I))return lt()}function d(e){var t=e.takeAPeek(R);if(t)return ct(t[0])}function v(e){var t=H(e);if(t)return ht(t)}function m(e){var t=L(e);if(t)return pt(t)}function g(e){var t=e.takeAPeek(X);if(t){var n=b(e);return n?mt(t[0],n):(n=N("(",")",u,gt,e),n?vt(t[0],n):dt(t[0]))}}function y(e){return N("[","]",u,gt,e)}function b(e){return N("{","}",w,yt,e)}function w(e){return C(E,e,k())}function E(e){var t=l(e);if(t)return t;t=S(e);if(t){if(e.skipWs().takeAPeek(":")){var n=f(e.skipWs());if(n)return St(t,n)}return Et(t)}}function S(e){var t=L(e);if(t)return t;var n=e.takeAPeek(W);if(n)return n[0]}function x(e){var t=e.takeAPeek(U);if(t){if(e.takeAPeek("@")){var n=T(e);if(n)return bt(t[0],n)}return wt(t[0])}}function T(e){return g(e)||y(e)||b(e)}function N(e,t,n,r,i){if(i.takeAPeek(e)){var s=n(i.skipWs());if(i.skipWs().takeAPeek(t))return r(s);Ct(i,"Expected "+t)}}function C(e,t,n){var r=[],i;for(;;){i=e(t);if(!(i&&!n||i&&n(i,t)))break;r.push(i);if(!t.skipWs().takeAPeek(","))break;t.skipWs()}return r}function k(){var e=0;return function(t,n){return(t.type==="rest"||t.type==="restIdentifier")&&++e>1&&(n.put(t.pattern),Ct(n,"Multiple ...'s not allowed")),!0}}function L(e){return A('"',V,e)||A("'",$,e)}function A(e,t,n){if(n.takeAPeek(e)){var r=O(t,n);if(n.takeAPeek(e))return r;Ct(n,"Expected "+e)}}function O(e,t){var n="";for(;;){var r=t.takeAPeek(e);if(r)n+=r;else{if(!t.peek("\\"))break;r=M(t);if(!r)break;n+=r}}return n}function M(e){return _(e)||D(Y,e)||D(G,e)||P(e)}function _(e){if(e.takeAPeek(Q))return"\0"}function D(e,t){var n=t.takeAPeek(e);if(n)return String.fromCharCode(parseInt("0x"+n[1]))}function P(e){var t=e.takeAPeek(K);if(t)return t[1].replace("b","\b").replace("f","\f").replace("n","\n").replace("r","\r").replace("t","	").replace("v","");t=e.takeAPeek(J);if(t)return t[1]}function H(e){var t="";e.takeAPeek("-")&&(t+="-");var n=F(e);return n&&(t+=n),n=B(e),n&&(t+=n),t&&t!=="-"&&(n=j(e),n&&(t+=n)),t==="-"&&Ct(e,"Expected number"),t||null}function B(e){if(e.takeAPeek(".")){var t=e.takeAPeek(nt);if(t)return"."+t;Ct(e,"Expected digit")}}function j(e){var t=e.takeAPeek(Z);if(t){var n=e.takeAPeek(nt);if(n)return t[0]+n}}function F(e){return e.takeAPeek(tt)||e.takeAPeek(rt)}function it(e,t,n,r){var i={pattern:t,type:e},s=arguments.length;return n!==undefined&&(i.value=n),r!==undefined&&(i.children=r),i}function st(e){return it("argumentList",xt(e).join(","),e)}function ot(e){return it("rest","...")}function ut(e){return it("restIdentifier",e+"...",e)}function at(){return it("wildcard","_")}function ft(){return it("null","null")}function lt(){return it("undefined","undefined")}function ct(e){return it("boolean",e,e==="true")}function ht(e){return it("number",e,parseFloat(e))}function pt(e){return it("string",Tt(e),e)}function dt(e){return it("className",e,e)}function vt(e,t){return it("classArray",e+t.pattern,e,t.children)}function mt(e,t){return it("classObject",e+t.pattern,e,t.children)}function gt(e){return it("array","["+xt(e).join(",")+"]",undefined,e)}function yt(e){return it("object","{"+xt(e).join(",")+"}",undefined,e)}function bt(e,t){return it("capture",e+"@"+t.pattern,e,[t])}function wt(e){return it("identifier",e,e)}function Et(e){return e=Tt(e),it("key",e,e)}function St(e,t){return e=Tt(e),it("keyValue",e+":"+t.pattern,e,[t])}function xt(e){return e.map(function(e){return e.pattern})}function Tt(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,Nt)+'"'}function Nt(e){var t=e.charCodeAt(0),n,r;t<=255?(n="x",r=2):(n="u",r=4);var i=t.toString(16);return"\\"+n+Array(r-i.length).join("0")+i}function Ct(e,t){throw t||(t="Unexpected character"),t+=" at column "+(e.pos+1),new SyntaxError(t+"\n"+e.input+"\n"+Array(e.input.length-e.buffer.length+1).join(" ")+"^")}var e={exports:{}},t=e.exports;t.parse=n,r.prototype.take=function(e){var t=this.buffer.substr(0,e);return this.buffer=this.buffer.substring(e),this.pos+=t.length,t},r.prototype.peek=function(e){return e instanceof RegExp?this.buffer.match(e):this.buffer.substr(0,e.length)===e?e:null},r.prototype.takeAPeek=function(e){var t=this.peek(e);if(t)return this.take((e instanceof RegExp?t[0]:t).length),t},r.prototype.skipWs=function(){while(this.takeAPeek(" "))continue;return this},r.prototype.put=function(e){this.buffer=e+this.buffer;var t=this.pos-e.length;return this.pos=t<0?0:t,this};var I=/^(undefined)\b/,q=/^(null)\b/,R=/^(true|false)\b/,U=/^[a-z][_$a-zA-Z0-9]*/,z=/^([a-z][_$a-zA-Z0-9]*)\.\.\./,W=/^[_$a-zA-Z][_$a-zA-Z0-9]*/,X=/^[A-Z][_$a-zA-Z0-9]*/,V=/^(?!["\\])./,$=/^(?!['\\])./,J=/^\\(.)/,K=/^\\(['"\\bfnrtv])/,Q=/^\\0(?![0-9])/,G=/^\\u([0-9a-fA-F]{4})/,Y=/^\\x([0-9a-fA-F]{2})/,Z=/^[eE](\+|-)?/,et=/^[0-9a-fA-F]/,tt=/^[1-9][0-9]+/,nt=/^[0-9]+/,rt=/^[0-9]/;return e.exports}(),e.modules["./compiler"]=function(){function n(e){var t=["var ret = [];",i(e),"return ret;"];return new Function(["args","runt"],t.join("\n"))}function i(e){var t=[];for(var n=0,r=e.value.length,i;n<r;n++)i="arg_"+n,t.push("var "+i+" = args["+n+"];",s(i,e.value[n]));return t.join("\n")}function s(e,t){return r[t.type](e,t)}function o(){return""}function u(e){return"if ("+e+" !== null) return false;"}function a(e){return"if ("+e+" !== void 0) return false;"}function f(e,t){return"if ("+e+" !== "+t.pattern+") return false;"}function l(e,t){return"if ("+e+" !== "+t.pattern+") return false;"}function c(e,t){return"if ("+e+" !== "+t.pattern+") return false;"}function h(e){return"ret.push("+e+");"}function p(e,t){return"if (!runt.matchesTypeName("+e+", '"+t.value+"')) return false;"}function d(e,t){var n=["ret.push("+e+");",s(e,t.children[0])];return n.join("\n")}function v(e){for(var t=0,n;n=e.children[t];t++)if(n.type==="rest"||n.type==="restIdentifier")return!0;return!1}function m(e,t){return v(t)?y(e,t):g(e,t)}function g(e,t){var n=t.children.length,r=["if (!("+e+" instanceof Array) || "+e+".length !== "+n+") return false;"];return t.children.forEach(function(t,n){var i=e+"_"+n;r.push("var "+i+" = "+e+"["+n+"];",s(i,t))}),r.join("\n")}function y(e,t){var n=t.children.length,r=n-1,i=e+"_pos",o=["if (!("+e+" instanceof Array) || "+e+".length < "+r+") return false;","var "+i+" = 0;"];return t.children.forEach(function(t,n){var u=e+"_"+n,a=t.type==="restIdentifier";a||t.type==="rest"?n===r&&a?o.push("ret.push("+e+".slice("+n+"));"):n===0?(o.push(i+" = "+e+".length - "+r+";"),a&&o.push("ret.push("+e+".slice(0, "+i+"));")):(o.push(i+" = "+e+".length - "+(r-n)+";"),a&&o.push("ret.push("+e+".slice("+n+", "+i+"));")):(o.push("var "+u+" = "+e+"["+i+"++];"),o.push(s(u,t)))}),o.join("\n")}function b(e,t){return v(t)?E(e,t):w(e,t)}function w(e,t){var n=e+"_keys",r=e+"_count",i=e+"_i",o=t.children.map(function(e){return e.value+":1"}),u=["if (!("+e+" instanceof Object)) return false;","var "+n+" = {"+o.join(",")+"};","var "+r+" = 0;","for (var "+i+" in "+e+") {","if (!("+n+".hasOwnProperty("+i+"))) return false;","else "+r+" += 1;","}","if ("+r+" !== "+t.children.length+") return false;"];return t.children.forEach(function(t,n){var r=e+"_"+n;t.type==="key"?u.push("ret.push("+e+"["+t.value+"]);"):u.push("var "+r+" = "+e+"["+t.value+"];",s(r,t.children[0]))}),u.join("\n")}function E(e,t){var n=e+"_keys",r=e+"_count",i=e+"_rest",o=e+"_i",u=t.children.length-1,a=!1,f=[];t.children.forEach(function(e){e.type==="restIdentifier"?a=!0:e.type!=="rest"&&f.push(e.value+":1")});var l=["if (!("+e+" instanceof Object)) return false;","var "+n+" = {"+f.join(",")+"};","var "+r+" = 0;"];return a&&l.push("var "+i+" = {};"),l.push("for (var "+o+" in "+e+") {"),a?l.push("if (!("+n+".hasOwnProperty("+o+"))) "+i+"["+o+"] = "+e+"["+o+"];","else "+r+" += 1;"):l.push("if ("+n+".hasOwnProperty("+o+")) "+r+" += 1;"),l.push("}","if ("+r+" !== "+u+") return false;"),t.children.forEach(function(t,n){var r=e+"_"+n;t.type==="key"?l.push("ret.push("+e+"["+t.value+"]);"):t.type==="keyValue"?l.push("var "+r+" = "+e+"["+t.value+"];",s(r,t.children[0])):t.type==="restIdentifier"&&l.push("ret.push("+i+");")}),l.join("\n")}function S(e,t){var n=e+"_vals",r=["if (!("+e+" instanceof Object)) return false;",p(e,t),"if (!"+e+".constructor || !"+e+".constructor.unapply) return false;","var "+n+" = "+e+".constructor.unapply("+e+");",m(n,t)];return r.join("\n")}function x(e,t){var n=e+"_vals",r=["if (!("+e+" instanceof Object)) return false;",p(e,t),"if (!"+e+".constructor || !"+e+".constructor.unapplyObj) return false;","var "+n+" = "+e+".constructor.unapplyObj("+e+");",b(n,t)];return r.join("\n")}var e={exports:{}},t=e.exports;t.compile=n;var r={wildcard:o,"null":u,"undefined":a,"boolean":f,number:l,string:c,identifier:h,array:m,object:b,classArray:S,classObject:x,className:p,capture:d};return e.exports}(),e.modules["./runtime"]=function(){function r(e,t){var r=n.call(e);if(r.substring(8,r.length-1)===t)return!0;if(e.constructor)if(e.constructor.name===t||e.constructor.className===t)return!0;return!1}var e={exports:{}},t=e.exports,n=Object.prototype.toString;return t.matchesTypeName=r,e.exports}(),e.modules["./matcher"]=function(){function i(e,t,n){this.patternFn=e,this.successFn=t,this.next=n}var t={exports:{}},n=t.exports,r=e("./runtime");return n.Matcher=i,i.prototype.match=function(e,t){var n=this.patternFn(e,r);if(n)return this.successFn.apply(t,n);if(this.next)return this.next.match(e,t);throw new TypeError("All patterns exhausted")},i.prototype.clone=function(){var e=new i(this.patternFn,this.successFn);return this.next&&(e.next=this.next.clone()),e},i.prototype.last=function(){var e=this;while(e.next)e=e.next;return e},i.prototype.pop=function(){var e=this,t;while(e.next)t=e,e=e.next;return t&&(t.next=null),e},t.exports}(),e.modules["./matches"]=function(){function f(){var e=o.call(arguments),t=typeof e[0],n=typeof e[1],s=typeof e[2],c,h,p,d,v,m,g,y;if(t!="function"||n!="undefined"&&n!="object"){if(t!="object"||n!="undefined"&&n!="object")return t=="function"&&n=="function"?(m=e[2]?e[2].clone():null,l(e[0],e[1],m)):(d=e[0],v=e[1],m=e[2]?e[2].clone():null,d in u?p=u[d]:(g=r.parse(d),g.pattern in a?p=u[d]=a[g.pattern]:(p=i.compile(g),p.pattern=g.pattern,u[d]=p,a[g.pattern]=p)),l(p,v,m));h=e[0],m=e[1]?e[1].clone():null;for(d in h)c=f(d,h[d],m),m=c.__matchChain;return c}c=e[0],m=e[1];if(!c.__matchChain)throw new Error("Not a matcher function");return m?(m=m.clone(),m.last().next=c.__matchChain.clone()):m=c.__matchChain.clone(),y=m.pop(),l(y.patternFn,y.successFn,m)}function l(e,t,n){var r=new s(e,t);n?n.last().next=r:n=r;var i=function(){var e=o.call(arguments);return n.match(e,this)};return i.alt=function(){var e=o.call(arguments);return e.push(n),f.apply(null,e)},i.__matchChain=n,i}function c(){var e=o.call(arguments,0,-1),t=arguments[arguments.length-1],r=this===n?null:this;if(typeof t=="function"){if(!t.__matchChain)throw new Error("Not a matcher function");return t.apply(r,e)}return f(t).apply(r,e)}var t={exports:{}},n=t.exports,r=e("./parser"),i=e("./compiler"),s=e("./matcher").Matcher,o=Array.prototype.slice,u={},a={};return n.pattern=f,n.caseOf=c,n.parser=r,n.compiler=i,t.exports}(),window.matches=e("./matches")})();